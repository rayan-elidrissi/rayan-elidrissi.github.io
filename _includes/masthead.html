{% include base_path %}

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button class="hidden"><div class="navicon"></div></button>
        <a class="site-title" href="{{ base_path }}/">{{ site.title }}</a>
        <ul class="visible-links right-links">
          {% for link in site.data.navigation.main %}
            {% if link.url contains 'http' %}
              {% assign domain = '' %}
            {% else %}
              {% assign domain = base_path %}
            {% endif %}
            {% assign is_active = false %}
            {% if page.url == link.url or page.url contains link.url %}
              {% assign is_active = true %}
            {% endif %}
            <li class="masthead__menu-item">
              <a class="{% if is_active %}is-active{% endif %}{% if link.url == '/publications/' %} nav-publications{% endif %}" href="{{ domain }}{{ link.url | strip }}">{{ link.title }}</a>
            </li>
          {% endfor %}
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

<script>
(function(){
  try {
    if (!(window.matchMedia && window.matchMedia('(max-width: 768px)').matches)) return;
    var nav = document.getElementById('site-nav');
    if (!nav) return;
    var v = nav.querySelector('.visible-links');
    var h = nav.querySelector('.hidden-links');
    var btn = nav.querySelector('button');
    if (!v || !h || !btn) return;
    while (v.firstElementChild) { h.insertBefore(v.lastElementChild, h.firstChild); }
    btn.classList.remove('hidden');
    btn.setAttribute('count', h.children.length);
    h.classList.add('hidden');
  } catch(e) { /* no-op */ }
})();
</script>